

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.4. Personnalisation du modèle de données &mdash; Documentation QGEP 0.8</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Recherche" href="../../search.html"/>
    <link rel="top" title="Documentation QGEP 0.8" href="../../index.html"/>
        <link rel="up" title="3. Guide d’administration" href="../index.html"/>
        <link rel="next" title="3.5. Update of the datamodel" href="../db-update-pum/index.html"/>
        <link rel="prev" title="3.3. Import de données INTERLIS" href="../data-import/index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> QGEP
        

        
        </a>

        
          
          
            <div class="version">
              0.7
            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">1. Guide d’installation de QGEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">2. Guide d’utilisateur de QGEP</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. Guide d’administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">3.1. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-export/index.html">3.2. Export de données au format INTERLIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-import/index.html">3.3. Import de données INTERLIS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.4. Personnalisation du modèle de données</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">3.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">3.4.2. Ajouter des champs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">3.4.3. Joindre des tables additionnelles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">3.4.4. Créer des vues personnalisées</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">3.5. Update of the datamodel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">4. Machine virtuelle de démonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wincan2qgep/index.html">5. Plugin Wincan 2 QGEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qgep_swmm/index.html">6. QGEP SWMM plugin</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">QGEP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html"><span class="section-number">3. </span>Guide d’administration</a> &raquo;</li>
      
    <li><span class="section-number">3.4. </span>Personnalisation du modèle de données</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customization-of-the-data-model">
<h1><span class="section-number">3.4. </span>Personnalisation du modèle de données<a class="headerlink" href="#customization-of-the-data-model" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ce chapître décrit les personnalisations possibles du modèle de données.</p>
<div class="section" id="introduction">
<h2><span class="section-number">3.4.1. </span>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le modèle de données est versionné et mis à jour à l’aide du Postgres Updates Manager (abr. <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>). Les vues requises pour l’édition des données sont générées automatiquement en utilisant la <a class="reference external" href="https://github.com/opengisch/pirogue">librairie Pirogue</a>.</p>
<p>La combinaison des deux rend possible l’introduction de petites personnalisations du modèle de données comme l’ajout de champs aux tables existantes ou l’extension de vues par jointure de tables additionnelles.</p>
<p>Avant d’aller plus loin, nous recommandons fortement de soumettre la question à la communauté si des doutes apparaissent sur la manière de sauvegarder n’importe quelle information dans la base de données. QGEP est compatible avec la <a class="reference external" href="http://www.sia.ch/405">SIA 405</a> Eaux usées ainsi qu’avec le modèle de données <a class="reference external" href="http://dss.vsa.ch">VSA-DSS</a>.</p>
<p>Dans le cas ou QGEP n’est actuellement pas en mesure de stocker certaines de vos données, merci de nous le faire savoir et de nous faire connaître l’utilisation qui y est associée. Le modèle de données QGEP est un modèle standard adaptatif qui devrait pouvoir suivre vos besoins.</p>
<p>Dans le cas où une personnalisation est inévitable, les explications et règles suivantes expliquent comment adapter le modèle de données QGEP à vos besoins spécifiques.</p>
</div>
<div class="section" id="adding-fields">
<h2><span class="section-number">3.4.2. </span>Ajouter des champs<a class="headerlink" href="#adding-fields" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est autorisé d’ajouter des champs additionnels aux tables en les nommant avec le préfixe <code class="docutils literal notranslate"><span class="pre">usr_…</span></code>.</p>
<p>If added in base tables, these additional fields will be automatically added to the views, being an editable field. The views can be re-generated any time using the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When running data model upgrades using PUM, it will be required to use the additional option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code></p>
</div>
</div>
<div class="section" id="joining-additional-tables">
<h2><span class="section-number">3.4.3. </span>Joindre des tables additionnelles<a class="headerlink" href="#joining-additional-tables" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible de joindre des tables supplémentaires aux deux vues principales (<code class="docutils literal notranslate"><span class="pre">vw_qgep_wastewater_structure</span></code> et <code class="docutils literal notranslate"><span class="pre">vw_qgep_reach</span></code>). Ceci est possible à l’aide du fichier de définition YAML pour chaque vue en définissant une liste des tables jointes. Les champs de ces tables sont joints en lecture seule étant donné que ces derniers ne sont pas pris en compte par les triggers d’édition. Dans le but de joindre une table à <code class="docutils literal notranslate"><span class="pre">qgep_od.wastewater_structure</span></code>, voici un exemple :</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
  <span class="nt">my_extra_join</span><span class="p">:</span>
    <span class="nt">table</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgep_od.my_table</span>
    <span class="nt">alias</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt_</span>
    <span class="nt">skip_columns</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_2</span>
    <span class="nt">remap_columns</span><span class="p">:</span>
      <span class="nt">field_3</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
    <span class="nt">join_on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> et <code class="docutils literal notranslate"><span class="pre">join_on</span></code> sont les clés obligatoires, les autres sont optionnelles.</p>
<p>Ce fichier YAML doit recevoir le chemin du fichier au lancement du script :</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--qgep_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>De la même manière pour la vue <code class="docutils literal notranslate"><span class="pre">vw_qgep_reach</span></code>, en spécifiant la variable <code class="docutils literal notranslate"><span class="pre">qgep_reach_extra</span></code> correspondant au chemin du fichier YAML.</p>
</div>
<div class="section" id="creating-custom-views">
<h2><span class="section-number">3.4.4. </span>Créer des vues personnalisées<a class="headerlink" href="#creating-custom-views" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible de créer des vues personnalisées et de les ajouter au modèle de données.</p>
<p>Afin de permettre les mises à niveau du modèle de données, un script de création et un script de suppression de la vue doivent être fournis. Ces scripts (SQL ou Python) doivent être placés dans un endroit spécifique et être nommés pre-all.{py,sql} et post-all.{py,sql}. Le chemin sera donné comme paramètre à PUM lors de la mise à niveau  (voir PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>Si quelqu’un souhaite avoir ces vues mises à jour automatiquement lors d’une mise à jour du modèle, Pirogue peut être utilisé dynamiquement pour générer les vues. L’exemple de création des vues dans le modèle peut être utilisé.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../db-update-pum/index.html" class="btn btn-neutral float-right" title="3.5. Update of the datamodel" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../data-import/index.html" class="btn btn-neutral" title="3.3. Import de données INTERLIS" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, The QGEP Project www.qgis.ch/en/projects/qgep-waste-water-module.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>