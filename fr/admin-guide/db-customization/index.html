

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.4. Personnalisation du modèle de données &mdash; documentation QGEP 0.8</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="documentation QGEP 0.8" href="../../index.html"/>
        <link rel="up" title="2. Guide d’administration" href="../index.html"/>
        <link rel="next" title="3. Machine virtuelle de démonstration" href="../../vm/index.html"/>
        <link rel="prev" title="2.3. Import de données INTERLIS" href="../data-import/index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../index.html" class="icon icon-home"> QGEP
        

        
        </a>

        
          
          
            <div class="version">
              0.7
            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">Guide d&#8217;installation de QGEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">1. Guide d&#8217;utilisateur de QGEP</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Guide d&#8217;administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">2.1. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-export/index.html">2.2. Export de données au format INTERLIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-import/index.html">2.3. Import de données INTERLIS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">2.4. Personnalisation du modèle de données</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">2.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">2.4.2. Ajouter des champs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">2.4.3. Joindre des tables additionnelles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">2.4.4. Créer des vues personnalisées</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">3. Machine virtuelle de démonstration</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">QGEP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">2. Guide d&#8217;administration</a> &raquo;</li>
      
    <li>2.4. Personnalisation du modèle de données</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/admin-guide/db-customization/index.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customization-of-the-data-model">
<h1>2.4. Personnalisation du modèle de données<a class="headerlink" href="#customization-of-the-data-model" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ce chapître décrit les personnalisations possibles du modèle de données.</p>
<div class="section" id="introduction">
<h2>2.4.1. Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le modèle de données est versionné et mis à jour à l&#8217;aide du Postgres Updates Manager (abr. <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>).&nbsp;Les vues requises pour l&#8217;édition des données sont générées automatiquement en utilisant la <a class="reference external" href="https://github.com/opengisch/pirogue">librairie Pirogue</a>.</p>
<p>La combinaison des deux rend possible l&#8217;introduction de petites personnalisations du modèle de données comme l&#8217;ajout de champs aux tables existantes ou l&#8217;extension de vues par jointure de tables additionnelles.</p>
<p>Avant d&#8217;aller plus loin, nous recommandons fortement de soumettre la question à la communauté si des doutes apparaissent sur la manière de sauvegarder n&#8217;importe quelle information dans la base de données. QGEP est compatible avec la <a class="reference external" href="http://www.sia.ch/405">SIA 405</a> Eaux usées ainsi qu&#8217;avec le modèle de données <a class="reference external" href="http://dss.vsa.ch">VSA-DSS</a>.</p>
<p>Dans le cas ou QGEP n&#8217;est actuellement pas en mesure de stocker certaines de vos données, merci de nous le faire savoir et de nous faire connaître l&#8217;utilisation qui y est associée. Le modèle de données QGEP est un modèle standard adaptatif qui devrait pouvoir suivre vos besoins.</p>
<p>Dans le cas où une personnalisation est inévitable, les explications et règles suivantes expliquent comment adapter le modèle de données QGEP à vos besoins spécifiques.</p>
</div>
<div class="section" id="adding-fields">
<h2>2.4.2. Ajouter des champs<a class="headerlink" href="#adding-fields" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est autorisé d&#8217;ajouter des champs additionnels aux tables en les nommant avec le préfixe <code class="docutils literal"><span class="pre">usr_…</span></code>.</p>
<p>If added in base tables, these additional fields will be automatically added to the views, being an editable field. The views can be re-generated any time using the following command:</p>
<p><code class="docutils literal"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When running data model upgrades using PUM, it will be required to use the additional option <code class="docutils literal"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code></p>
</div>
</div>
<div class="section" id="joining-additional-tables">
<h2>2.4.3. Joindre des tables additionnelles<a class="headerlink" href="#joining-additional-tables" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible de joindre des tables supplémentaires aux deux vues principales (<code class="docutils literal"><span class="pre">vw_qgep_wastewater_structure</span></code> et <code class="docutils literal"><span class="pre">vw_qgep_reach</span></code>). Ceci est possible à l&#8217;aide du fichier de définition YAML pour chaque vue en définissant une liste des tables jointes. Les champs de ces tables sont joints en lecture seule étant donné que ces derniers ne sont pas pris en compte par les triggers d&#8217;édition. Dans le but de joindre une table à <code class="docutils literal"><span class="pre">qgep_od.wastewater_structure</span></code>, voici un exemple :</p>
<div class="code YAML highlight-python"><div class="highlight"><pre><span></span>joins:
  my_extra_join:
    table: qgep_od.my_table
    alias: mt
    prefix: mt_
    skip_columns:
      - field_1
      - field_2
    remap_columns:
      field_3: my_renamed_field
    join_on: mt.fk_ws = ws.obj_id
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">table</span></code> et <code class="docutils literal"><span class="pre">join_on</span></code> sont les clés obligatoires, les autres sont optionnelles.</p>
<p>Ce fichier YAML doit recevoir le chemin du fichier au lancement du script :</p>
<p><code class="docutils literal"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--qgep_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>De la même manière pour la vue <code class="docutils literal"><span class="pre">vw_qgep_reach</span></code>, en spécifiant la variable <code class="docutils literal"><span class="pre">qgep_reach_extra</span></code> correspondant au chemin du fichier YAML.</p>
</div>
<div class="section" id="creating-custom-views">
<h2>2.4.4. Créer des vues personnalisées<a class="headerlink" href="#creating-custom-views" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il est possible de créer des vues personnalisées et de les ajouter au modèle de données.</p>
<p>In order to allow upgrades of the data model, one should provide a script to create them and one to delete them.
These scripts (SQL or Python) should be placed in a specific path and name them as pre-all.{py,sql} and post-all.{py,sql}.
This path shall be given as argument to PUM when upgrading the data model as a delta directory (see PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>Si quelqu&#8217;un souhaite avoir ces vues mises à jour automatiquement lors d&#8217;une mise à jour du modèle, Pirogue peut être utilisé dynamiquement pour générer les vues. L&#8217;exemple de création des vues dans le modèle peut être utilisé.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../vm/index.html" class="btn btn-neutral float-right" title="3. Machine virtuelle de démonstration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../data-import/index.html" class="btn btn-neutral" title="2.3. Import de données INTERLIS" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, The QGEP Project www.qgis.ch/en/projects/qgep-waste-water-module.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>