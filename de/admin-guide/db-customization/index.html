<!DOCTYPE html>
<html class="writer-html5" lang="de" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.4. Anpassung des Datenmodells &mdash; QGEP 0.8 Dokumentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="4.5. Datenmodell Werkzeug" href="../datamodel-tool/index.html" />
    <link rel="prev" title="4.3. INTERLIS Datenaustausch" href="../interlis-io/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> QGEP
          </a>
              <div class="version">
                0.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../features-guide/index.html">1. TEKSI-Modul ABWASSER &amp; GEP / QGEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">2. Leitfaden QGEP Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">3. QGEP Benutzerhandbuch</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">4. Administratorhandbuch</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">4.1. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">4.2. User Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlis-io/index.html">4.3. INTERLIS Datenaustausch</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.4. Anpassung des Datenmodells</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.4.1. Einleitung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">4.4.2. Zusätzliche Felder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">4.4.3. Verknüpfung zusätzlicher Tabellen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">4.4.4. Creating custom views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datamodel-tool/index.html">4.5. Datenmodell Werkzeug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">4.6. Manual update of the datamodel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">5. Demo virtuelle Maschine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wincan2qgep/index.html">6. Wincan 2 QGEP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qgep_swmm/index.html">7. QGEP SWMM plugin</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QGEP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">4. </span>Administratorhandbuch</a> &raquo;</li>
      <li><span class="section-number">4.4. </span>Anpassung des Datenmodells</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> Quelltext anzeigen</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="customization-of-the-data-model">
<h1><span class="section-number">4.4. </span>Anpassung des Datenmodells<a class="headerlink" href="#customization-of-the-data-model" title="Link zu dieser Überschrift"></a></h1>
<p>Dieses Kapitel beschreibt die möglichen Anpassungen des Datenmodells.</p>
<section id="introduction">
<h2><span class="section-number">4.4.1. </span>Einleitung<a class="headerlink" href="#introduction" title="Link zu dieser Überschrift"></a></h2>
<p>Das Datenmodell ist versioniert und Aktualisierungen werden mit dem Postgres Updates Manager (auch bekannt als <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>) durchgeführt. Die zur Bearbeitung der Daten erforderlichen Ansichten werden automatisch mit der Bibliothek „Pirogue &lt;<a class="reference external" href="https://github.com/opengisch/pirogue">https://github.com/opengisch/pirogue</a>&gt;“ erzeugt.</p>
<p>Die Kombination von beidem ermöglicht kleine Anpassungen des Datenmodells, wie das Hinzufügen von Feldern zu bestehenden Basistabellen oder die Erweiterung von Ansichten durch das Verbinden zusätzlicher Tabellen.</p>
<p>Bevor Sie fortfahren, empfehlen wir Ihnen dringend, die Community zu fragen, wenn Sie irgendwelche Fragen haben, wie Sie Informationen in der Datenbank speichern können. QGEP erfüllt die Anforderungen der SIA 405 &lt;<a class="reference external" href="http://www.sia.ch/405">http://www.sia.ch/405</a>&gt;`_ Abwasser und des VSA-DSS &lt;<a class="reference external" href="http://dss.vsa.ch">http://dss.vsa.ch</a>&gt;`_ Datenmodells.</p>
<p>Wenn das QGEP-Datenmodell noch nicht in der Lage ist, bestimmte Daten zu speichern, teilen Sie uns bitte mit, um welche Art von Daten es sich handelt und wie sie behandelt werden sollen. Das QGEP-Datenmodell ist ein standardisiertes, anpassungsfähiges Modell welches viele ihrer Anforderung schon abdeckt.</p>
<p>Sollte dennoch eine Anpassung erforderlich sein, erklären die folgenden Erläuterungen und Regeln, wie Sie das QGEP-Datenmodell an Ihre spezifischen Bedürfnisse anpassen können.</p>
</section>
<section id="adding-fields">
<h2><span class="section-number">4.4.2. </span>Zusätzliche Felder<a class="headerlink" href="#adding-fields" title="Link zu dieser Überschrift"></a></h2>
<p>Es ist erlaubt, zusätzliche Felder zu Tabellen hinzuzufügen, indem man sie als <code class="docutils literal notranslate"><span class="pre">usr_...</span></code> benennt.</p>
<p>Wenn sie in Basistabellen hinzugefügt werden, werden diese zusätzlichen Felder automatisch zu den Ansichten hinzugefügt, da es sich um ein bearbeitbares Feld handelt. Die Ansichten können jederzeit mit dem folgenden Befehl neu generiert werden:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>Wenn Datenmodell-Upgrades unter Verwendung von PUM durchgeführt werden, ist es erforderlich, die zusätzliche Option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code> zu verwenden.</p>
</div>
</section>
<section id="joining-additional-tables">
<h2><span class="section-number">4.4.3. </span>Verknüpfung zusätzlicher Tabellen<a class="headerlink" href="#joining-additional-tables" title="Link zu dieser Überschrift"></a></h2>
<p>Es ist möglich, zusätzliche Tabellen mit den beiden Hauptansichten (<code class="docutils literal notranslate"><span class="pre">vw_qgep_Abwasserbauwerk</span></code> und <code class="docutils literal notranslate"><span class="pre">vw_qgep_Haltung</span></code>) zu verbinden. Dazu wird für jeden View eine YAML-Definitionsdatei verwendet, in der eine Liste von verbundenen Tabellen definiert wird. Felder dieser Tabellen werden als schreibgeschützte Felder verknüpft, da sie in Edit-Triggern verworfen werden. Für das Verknüpfen einer Tabelle zu <code class="docutils literal notranslate"><span class="pre">qgep_od.wastewater_structure</span></code>, hier ein Beispiel:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
  <span class="nt">my_extra_join</span><span class="p">:</span>
    <span class="nt">table</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgep_od.my_table</span>
    <span class="nt">alias</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt_</span>
    <span class="nt">skip_columns</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_2</span>
    <span class="nt">remap_columns</span><span class="p">:</span>
      <span class="nt">field_3</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
    <span class="nt">join_on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> und <code class="docutils literal notranslate"><span class="pre">join_on</span></code> sind Pflichtschlüssel, alle anderen sind optional.</p>
<p>Diese YAML-Datei sollte beim Ausführen des Skripts als Dateipfad angegeben werden:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--qgep_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>Ähnliches gilt für die View <code class="docutils literal notranslate"><span class="pre">vw_qgep_reach</span></code>, indem Sie die Variable <code class="docutils literal notranslate"><span class="pre">qgep_reach_extra</span></code> auf den entsprechenden YAML-Dateipfad setzen.</p>
</section>
<section id="creating-custom-views">
<h2><span class="section-number">4.4.4. </span>Creating custom views<a class="headerlink" href="#creating-custom-views" title="Link zu dieser Überschrift"></a></h2>
<p>It is possible to create custom views and add them to the data model.</p>
<p>In order to allow upgrades of the data model, one should provide a script to create them and one to delete them.
These scripts (SQL or Python) should be placed in a specific path and name them as pre-all.{py,sql} and post-all.{py,sql}.
This path shall be given as argument to PUM when upgrading the data model as a delta directory (see PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>If one wants to have these views automatically updated when fields are added the data model, Pirogue can be used to dynamically generate the views. You can take example of the creation of the views in the data model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../interlis-io/index.html" class="btn btn-neutral float-left" title="4.3. INTERLIS Datenaustausch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="../datamodel-tool/index.html" class="btn btn-neutral float-right" title="4.5. Datenmodell Werkzeug" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The QGEP Project www.qgis.ch/en/projects/qgep-waste-water-module.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>