<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.4. Personalización del modelo de datos &mdash; documentación de QGEP - 0.8</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="4.5. Data-model tool" href="../datamodel-tool/index.html" />
    <link rel="prev" title="4.3. INTERLIS Data exchange" href="../interlis-io/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> QGEP
          </a>
              <div class="version">
                0.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../features-guide/index.html">1. QGEP / TEKSI wastewater module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation-guide/index.html">2. Guía de instalación de QGEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">3. Guía de Usuario QGEP</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">4. Guía del administrador</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../pgadmin/index.html">4.1. pgAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">4.2. User Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interlis-io/index.html">4.3. INTERLIS Data exchange</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.4. Personalización del modelo de datos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">4.4.1. Introducción</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-fields">4.4.2. Agregando campos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#joining-additional-tables">4.4.3. Uniendo tablas adicionales</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-views">4.4.4. Creando vistas personalizadas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../datamodel-tool/index.html">4.5. Data-model tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db-update-pum/index.html">4.6. Manual update of the datamodel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">5. Demostración de una Máquina Virtual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../wincan2qgep/index.html">6. Wincan 2 QGEP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../qgep_swmm/index.html">7. QGEP SWMM plugin</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QGEP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">4. </span>Guía del administrador</a> &raquo;</li>
      <li><span class="section-number">4.4. </span>Personalización del modelo de datos</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/admin-guide/db-customization/index.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="customization-of-the-data-model">
<h1><span class="section-number">4.4. </span>Personalización del modelo de datos<a class="headerlink" href="#customization-of-the-data-model" title="Enlazar permanentemente con este título"></a></h1>
<p>Este capítulo describe la posible personalización del modelo de datos.</p>
<section id="introduction">
<h2><span class="section-number">4.4.1. </span>Introducción<a class="headerlink" href="#introduction" title="Enlazar permanentemente con este título"></a></h2>
<p>The data model is versioned and updates are achieved using Postgres Updates Manager (aka <a class="reference external" href="https://github.com/opengisch/pum">PUM</a>).
The views required to edit the data are automatically generated using <a class="reference external" href="https://github.com/opengisch/pirogue">Pirogue</a> library.</p>
<p>La combinación de ambos permite introducir pequeñas personalizaciones del modelo de datos, como agregar campos a las bases de las tablas existentes o ampliar las vistas uniendo tablas adicionales.</p>
<p>Antes de continuar, le recomendamos que consulte a la comunidad si tiene alguna duda sobre cómo almacenar cualquier información en la base de datos. QGEP cumple con <a class="reference external" href="http://www.sia.ch/405">Aguas residuales SIA 405</a>  y <a class="reference external" href="http://dss.vsa.ch">modelo de datos VSA-DSS</a>.</p>
<p>If QGEP data model is not able yet to hold some data, please let us know what kind and how it should be handled. QGEP data model is a standard proof adaptative model and could follow your needs.</p>
<p>Si aún se requiere una personalización, las siguientes explicaciones y reglas explican cómo adaptar el modelo de datos QGEP a sus necesidades específicas.</p>
</section>
<section id="adding-fields">
<h2><span class="section-number">4.4.2. </span>Agregando campos<a class="headerlink" href="#adding-fields" title="Enlazar permanentemente con este título"></a></h2>
<p>Está permitido agregar campos adicionales a las tablas simplemente nombrándolas como <code class="docutils literal notranslate"><span class="pre">usr_…</span></code>.</p>
<p>If added in base tables, these additional fields will be automatically added to the views, being an editable field. The views can be re-generated any time using the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span></code></p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>When running data model upgrades using PUM, it will be required to use the additional option <code class="docutils literal notranslate"><span class="pre">--exclude-field-pattern</span> <span class="pre">'usr_%'</span></code></p>
</div>
</section>
<section id="joining-additional-tables">
<h2><span class="section-number">4.4.3. </span>Uniendo tablas adicionales<a class="headerlink" href="#joining-additional-tables" title="Enlazar permanentemente con este título"></a></h2>
<p>It is possible to join additional tables to the two main views (<code class="docutils literal notranslate"><span class="pre">vw_qgep_wastewater_structure</span></code> and <code class="docutils literal notranslate"><span class="pre">vw_qgep_reach</span></code>).
This is done by using a YAML definition file for each view and defining a list of joined tables.
Fields of these tables will be joined as read-only fields as they are discarded in edit triggers.
For joining a table to <code class="docutils literal notranslate"><span class="pre">qgep_od.wastewater_structure</span></code>, here is an example:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">joins</span><span class="p">:</span>
  <span class="nt">my_extra_join</span><span class="p">:</span>
    <span class="nt">table</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgep_od.my_table</span>
    <span class="nt">alias</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt_</span>
    <span class="nt">skip_columns</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_1</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">field_2</span>
    <span class="nt">remap_columns</span><span class="p">:</span>
      <span class="nt">field_3</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_renamed_field</span>
    <span class="nt">join_on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mt.fk_ws = ws.obj_id</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code> y <code class="docutils literal notranslate"><span class="pre">join_on</span></code> son claves obligatorias, todas las demás son opcionales.</p>
<p>Este archivo YAML se debe proporcionar como una ruta de archivo al ejecutar el script:</p>
<p><code class="docutils literal notranslate"><span class="pre">./view/create_views.py</span> <span class="pre">--pg_service</span> <span class="pre">pg_qgep</span> <span class="pre">--srid</span> <span class="pre">2056</span> <span class="pre">--qgep_wastewater_structure_extra</span> <span class="pre">/path_to/extra_ws.yaml</span></code></p>
<p>And similarly for <code class="docutils literal notranslate"><span class="pre">vw_qgep_reach</span></code> view, by specifying <code class="docutils literal notranslate"><span class="pre">qgep_reach_extra</span></code> variable to the corresponding YAML file path.</p>
</section>
<section id="creating-custom-views">
<h2><span class="section-number">4.4.4. </span>Creando vistas personalizadas<a class="headerlink" href="#creating-custom-views" title="Enlazar permanentemente con este título"></a></h2>
<p>Es posible crear vistas personalizadas y agregarlas al modelo de datos.</p>
<p>In order to allow upgrades of the data model, one should provide a script to create them and one to delete them.
These scripts (SQL or Python) should be placed in a specific path and name them as pre-all.{py,sql} and post-all.{py,sql}.
This path shall be given as argument to PUM when upgrading the data model as a delta directory (see PUM <a class="reference external" href="https://github.com/opengisch/pum">documentation</a>).</p>
<p>If one wants to have these views automatically updated when fields are added the data model, Pirogue can be used to dynamically generate the views. You can take example of the creation of the views in the data model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../interlis-io/index.html" class="btn btn-neutral float-left" title="4.3. INTERLIS Data exchange" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../datamodel-tool/index.html" class="btn btn-neutral float-right" title="4.5. Data-model tool" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2021, The QGEP Project www.qgis.ch/en/projects/qgep-waste-water-module.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>